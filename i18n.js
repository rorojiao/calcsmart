/* CalcSmart i18n */
const T = {
  // Global
  siteName: { zh: 'CalcSmart Êô∫ÁÆó', en: 'CalcSmart' },
  home: { zh: 'È¶ñÈ°µ', en: 'Home' },
  mortgage: { zh: 'ÊàøË¥∑ËÆ°ÁÆóÂô®', en: 'Mortgage' },
  tax: { zh: '‰∏™Á®éËÆ°ÁÆóÂô®', en: 'Tax' },
  bmi: { zh: 'BMIËÆ°ÁÆóÂô®', en: 'BMI' },
  unit: { zh: 'Âçï‰ΩçÊç¢ÁÆó', en: 'Unit' },
  countdown: { zh: 'ÂÄíËÆ°Êó∂', en: 'Countdown' },
  calculate: { zh: 'ËÆ°ÁÆó', en: 'Calculate' },
  reset: { zh: 'ÈáçÁΩÆ', en: 'Reset' },
  donateTip: { zh: '‚òï ËßâÂæóÂ•ΩÁî®ÔºüÊâìËµè‰∏ÄÊùØÂíñÂï°', en: '‚òï Find it useful? Buy me a coffee' },
  donateAddr: { zh: 'ETH/USDT ÊâìËµèÂú∞ÂùÄ:', en: 'ETH/USDT Tip:' },
  footer: { zh: '¬© 2026 CalcSmart Êô∫ÁÆó ¬∑ ÂÖçË¥πÂú®Á∫øËÆ°ÁÆóÂô®', en: '¬© 2026 CalcSmart ¬∑ Free Online Calculators' },

  // Index
  indexTitle: { zh: 'ÂÖçË¥πÂú®Á∫øËÆ°ÁÆóÂô®ÂêàÈõÜ', en: 'Free Online Calculator Collection' },
  indexSub: { zh: 'Á≤æÂáÜ„ÄÅÂø´ÈÄü„ÄÅÂ•ΩÁî®ÁöÑÂú®Á∫øËÆ°ÁÆóÂ∑•ÂÖ∑', en: 'Accurate, fast, and easy-to-use online calculators' },
  mortgageDesc: { zh: 'Á≠âÈ¢ùÊú¨ÊÅØ/Á≠âÈ¢ùÊú¨ÈáëÔºåÊúà‰æõ‰∏éËøòÊ¨æÊòéÁªÜ', en: 'Monthly payment, total interest, amortization' },
  taxDesc: { zh: '2026‰∏≠ÂõΩ‰∏™Á®éÔºå‰∏ìÈ°πÊâ£Èô§ÔºåÂà∞ÊâãÂ∑•ËµÑ', en: 'China income tax with deductions' },
  bmiDesc: { zh: 'Ë∫´È´ò‰ΩìÈáçËÆ°ÁÆóBMIÔºåÂÅ•Â∫∑Âª∫ËÆÆ', en: 'Calculate BMI with health advice' },
  unitDesc: { zh: 'ÈïøÂ∫¶„ÄÅÈáçÈáè„ÄÅÊ∏©Â∫¶Á≠â‰∏áËÉΩÊç¢ÁÆó', en: 'Length, weight, temperature & more' },
  countdownDesc: { zh: 'Á∫™ÂøµÊó•„ÄÅÂÄíËÆ°Êó∂„ÄÅÂú®‰∏ÄËµ∑Â§öÂ∞ëÂ§©', en: 'Anniversary, countdown, days together' },

  // Mortgage
  mortgageTitle: { zh: 'ÊàøË¥∑ËÆ°ÁÆóÂô® ‚Äî Âú®Á∫øËÆ°ÁÆóÊúà‰æõ', en: 'Mortgage Calculator ‚Äî Monthly Payment' },
  mortgageSub: { zh: 'ÊîØÊåÅÁ≠âÈ¢ùÊú¨ÊÅØÂíåÁ≠âÈ¢ùÊú¨Èáë‰∏§ÁßçËøòÊ¨æÊñπÂºè', en: 'Equal payment & equal principal methods' },
  loanAmount: { zh: 'Ë¥∑Ê¨æÈáëÈ¢ùÔºà‰∏áÂÖÉÔºâ', en: 'Loan Amount (¬•10K)' },
  loanYears: { zh: 'Ë¥∑Ê¨æÂπ¥ÈôêÔºàÂπ¥Ôºâ', en: 'Loan Term (years)' },
  annualRate: { zh: 'Âπ¥Âà©ÁéáÔºà%Ôºâ', en: 'Annual Rate (%)' },
  equalPayment: { zh: 'Á≠âÈ¢ùÊú¨ÊÅØ', en: 'Equal Payment' },
  equalPrincipal: { zh: 'Á≠âÈ¢ùÊú¨Èáë', en: 'Equal Principal' },
  monthlyPayment: { zh: 'Êúà‰æõ', en: 'Monthly Payment' },
  totalInterest: { zh: 'ÊÄªÂà©ÊÅØ', en: 'Total Interest' },
  totalPayment: { zh: 'ËøòÊ¨æÊÄªÈ¢ù', en: 'Total Payment' },
  firstMonth: { zh: 'È¶ñÊúàÊúà‰æõ', en: 'First Month' },
  lastMonth: { zh: 'Êú´ÊúàÊúà‰æõ', en: 'Last Month' },
  month: { zh: 'Êúà', en: 'Mo' },
  principal: { zh: 'Êú¨Èáë', en: 'Principal' },
  interest: { zh: 'Âà©ÊÅØ', en: 'Interest' },
  balance: { zh: '‰ΩôÈ¢ù', en: 'Balance' },
  repaySchedule: { zh: 'ËøòÊ¨æÊòéÁªÜË°®', en: 'Amortization Schedule' },
  paymentChart: { zh: 'Êúà‰æõËµ∞ÂäøÂõæ', en: 'Payment Chart' },
  yuan: { zh: 'ÂÖÉ', en: '¬•' },

  // Tax
  taxTitle: { zh: '‰∏™‰∫∫ÊâÄÂæóÁ®éËÆ°ÁÆóÂô® 2026', en: 'Income Tax Calculator 2026' },
  taxSub: { zh: '‰∏≠ÂõΩ‰∏™Á®éËÆ°ÁÆóÔºåËæìÂÖ•ÊúàËñ™ÁÆóÂà∞ÊâãÂ∑•ËµÑ', en: 'China income tax, calculate take-home pay' },
  monthlySalary: { zh: 'Á®éÂâçÊúàËñ™ÔºàÂÖÉÔºâ', en: 'Monthly Salary (¬•)' },
  socialInsurance: { zh: '‰∫îÈô©‰∏ÄÈáëÔºàÂÖÉ/ÊúàÔºâ', en: 'Social Insurance (¬•/mo)' },
  specialDeduction: { zh: '‰∏ìÈ°πÈôÑÂä†Êâ£Èô§ÔºàÂÖÉ/ÊúàÔºâ', en: 'Special Deduction (¬•/mo)' },
  threshold: { zh: 'Ëµ∑ÂæÅÁÇπ', en: 'Threshold' },
  taxableIncome: { zh: 'Â∫îÁ∫≥Á®éÊâÄÂæóÈ¢ù', en: 'Taxable Income' },
  monthlyTax: { zh: 'ÊúàÁº¥‰∏™Á®é', en: 'Monthly Tax' },
  takeHome: { zh: 'Âà∞ÊâãÂ∑•ËµÑ', en: 'Take-home Pay' },
  annualTax: { zh: 'Âπ¥Áº¥‰∏™Á®é', en: 'Annual Tax' },
  annualTakeHome: { zh: 'Âπ¥Âà∞Êâã', en: 'Annual Net' },

  // BMI
  bmiTitle: { zh: 'BMIËÆ°ÁÆóÂô® ‚Äî Ë∫´‰ΩìË¥®ÈáèÊåáÊï∞', en: 'BMI Calculator ‚Äî Body Mass Index' },
  bmiSub: { zh: 'ËæìÂÖ•Ë∫´È´ò‰ΩìÈáçÔºåËé∑ÂèñBMIÂÄºÂíåÂÅ•Â∫∑Âª∫ËÆÆ', en: 'Enter height & weight for BMI and health advice' },
  height: { zh: 'Ë∫´È´òÔºàcmÔºâ', en: 'Height (cm)' },
  weight: { zh: '‰ΩìÈáçÔºàkgÔºâ', en: 'Weight (kg)' },
  yourBmi: { zh: '‰Ω†ÁöÑBMI', en: 'Your BMI' },
  underweight: { zh: 'ÂÅèÁò¶', en: 'Underweight' },
  normal: { zh: 'Ê≠£Â∏∏', en: 'Normal' },
  overweight: { zh: 'ÂÅèËÉñ', en: 'Overweight' },
  obese: { zh: 'ËÇ•ËÉñ', en: 'Obese' },
  bmiAdviceUnder: { zh: 'Âª∫ËÆÆÈÄÇÂΩìÂ¢ûÂä†Ëê•ÂÖªÊëÑÂÖ•ÔºåÂä†Âº∫ÈîªÁÇº', en: 'Consider increasing nutrition and exercise' },
  bmiAdviceNormal: { zh: '‰ΩìÈáçÊ≠£Â∏∏ÔºåËØ∑ÁªßÁª≠‰øùÊåÅÂÅ•Â∫∑ÁîüÊ¥ªÊñπÂºè', en: 'Healthy weight! Keep up your lifestyle' },
  bmiAdviceOver: { zh: 'Âª∫ËÆÆÊéßÂà∂È•ÆÈ£üÔºåÂ¢ûÂä†ËøêÂä®Èáè', en: 'Consider diet control and more exercise' },
  bmiAdviceObese: { zh: 'Âª∫ËÆÆÂí®ËØ¢ÂåªÁîüÔºåÂà∂ÂÆöÂáèÈáçËÆ°Âàí', en: 'Please consult a doctor for a weight plan' },

  // Unit
  unitTitle: { zh: '‰∏áËÉΩÂçï‰ΩçÊç¢ÁÆóÂô®', en: 'Universal Unit Converter' },
  unitSub: { zh: 'ÈïøÂ∫¶„ÄÅÈáçÈáè„ÄÅÊ∏©Â∫¶„ÄÅÈù¢ÁßØ„ÄÅ‰ΩìÁßØ„ÄÅÈÄüÂ∫¶ÂÆûÊó∂Êç¢ÁÆó', en: 'Length, weight, temp, area, volume, speed converter' },
  length: { zh: 'ÈïøÂ∫¶', en: 'Length' },
  weightCat: { zh: 'ÈáçÈáè', en: 'Weight' },
  temperature: { zh: 'Ê∏©Â∫¶', en: 'Temperature' },
  area: { zh: 'Èù¢ÁßØ', en: 'Area' },
  volume: { zh: '‰ΩìÁßØ', en: 'Volume' },
  speed: { zh: 'ÈÄüÂ∫¶', en: 'Speed' },

  // Countdown
  countdownTitle: { zh: 'Á∫™ÂøµÊó• & ÂÄíËÆ°Êó∂ËÆ°ÁÆóÂô®', en: 'Anniversary & Countdown Calculator' },
  countdownSub: { zh: 'ËÆ°ÁÆó‰∏§‰∏™Êó•Êúü‰πãÈó¥ÁöÑÂ§©Êï∞ÔºåÁîüÊàêÂàÜ‰∫´Âç°Áâá', en: 'Calculate days between dates, generate share cards' },
  startDate: { zh: 'ÂºÄÂßãÊó•Êúü', en: 'Start Date' },
  endDate: { zh: 'ÁªìÊùüÊó•ÊúüÔºàÈªòËÆ§‰ªäÂ§©Ôºâ', en: 'End Date (default today)' },
  daysCount: { zh: 'Â§©', en: 'days' },
  togetherText: { zh: 'Êàë‰ª¨Â∑≤ÁªèÂú®‰∏ÄËµ∑', en: "We've been together for" },
  daysUntil: { zh: 'Ë∑ùÁ¶ªÁõÆÊ†áËøòÊúâ', en: 'Days until target:' },
  copyShare: { zh: 'Â§çÂà∂ÂàÜ‰∫´ÊñáÂ≠ó', en: 'Copy Share Text' },
  copied: { zh: 'Â∑≤Â§çÂà∂ÔºÅ', en: 'Copied!' },
};

let lang = localStorage.getItem('cs_lang') || (navigator.language.startsWith('zh') ? 'zh' : 'en');

function t(key) { return T[key] ? (T[key][lang] || T[key].en) : key; }

function setLang(l) {
  lang = l;
  localStorage.setItem('cs_lang', l);
  document.documentElement.lang = l === 'zh' ? 'zh-CN' : 'en';
  document.querySelectorAll('[data-t]').forEach(el => {
    const k = el.getAttribute('data-t');
    if (el.tagName === 'INPUT' || el.tagName === 'SELECT') el.placeholder = t(k);
    else el.textContent = t(k);
  });
  document.querySelectorAll('[data-t-title]').forEach(el => {
    document.title = t(el.getAttribute('data-t-title'));
  });
  if (typeof onLangChange === 'function') onLangChange();
}

function toggleLang() {
  setLang(lang === 'zh' ? 'en' : 'zh');
}

document.addEventListener('DOMContentLoaded', () => setLang(lang));

/* Shared: header HTML generator */
function renderHeader(active) {
  const nav = [
    ['index.html', 'home'], ['mortgage.html', 'mortgage'], ['tax.html', 'tax'],
    ['bmi.html', 'bmi'], ['unit.html', 'unit'], ['countdown.html', 'countdown']
  ];
  return `<header class="header"><div class="header-inner">
    <a href="index.html" class="logo">‚ö° <span data-t="siteName">CalcSmart</span></a>
    <button class="nav-toggle" onclick="document.querySelector('.nav').classList.toggle('open')">‚ò∞</button>
    <nav class="nav">${nav.map(([h,k])=>`<a href="${h}" class="${active===k?'active':''}" data-t="${k}">${t(k)}</a>`).join('')}
    <button class="lang-btn" onclick="toggleLang()">üåê ${lang==='zh'?'EN':'‰∏≠Êñá'}</button></nav>
  </div></header>`;
}

function renderFooter() {
  return `<div class="donate"><p data-t="donateTip">${t('donateTip')}</p><p><span data-t="donateAddr">${t('donateAddr')}</span> <code>0xEeD903787Cb86bcCc17777E5C7d10A4c2De43823</code></p></div>
  <footer class="footer" data-t="footer">${t('footer')}</footer>`;
}

function fmt(n) { return n.toLocaleString('zh-CN', {minimumFractionDigits:2, maximumFractionDigits:2}); }
